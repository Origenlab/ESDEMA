---
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/cdmx/', label: 'CDMX', icon: 'building' },
  { href: '/estados/', label: 'Estados', icon: 'map' },
  { href: '/blog/', label: 'Blog', icon: 'book' },
  { href: '/faq/', label: 'FAQ', icon: 'help' },
];
---

<header class="site-header" id="site-header">
  <div class="container header-inner">
    <!-- Logo -->
    <a href="/" class="brand" aria-label="Ir al inicio de ESDEMA">
      <span class="brand-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </svg>
      </span>
      <span>ESDEMA</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="nav-main" aria-label="Navegacion principal">
      <ul class="nav-list">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`nav-link ${currentPath.startsWith(link.href) ? 'active' : ''}`}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- Actions -->
    <div class="header-actions">
      <a href="/contacto/" class="btn btn-primary btn-sm">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
        <span class="btn-text-desktop">Contacto</span>
      </a>

      <!-- Mobile Menu Toggle -->
      <button
        class="menu-toggle"
        id="menu-toggle"
        aria-label="Abrir menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg class="icon-menu" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <svg class="icon-close hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobile-menu" aria-hidden="true">
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`mobile-nav-link ${currentPath.startsWith(link.href) ? 'active' : ''}`}
            >
              {link.label}
            </a>
          </li>
        ))}
        <li>
          <a href="/contacto/" class="mobile-nav-link mobile-nav-cta">
            Contacto
          </a>
        </li>
      </ul>
    </nav>
  </div>
</header>

<style>
  .btn-text-desktop {
    display: none;
  }

  @media (min-width: 768px) {
    .btn-text-desktop {
      display: inline;
    }
  }

  /* Mobile Menu Styles */
  .mobile-menu {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: 0;
    background: white;
    z-index: 40;
    padding: var(--space-lg);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
  }

  .mobile-menu.open {
    transform: translateX(0);
  }

  .mobile-nav-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md) var(--space-lg);
    font-size: var(--text-lg);
    font-weight: 500;
    color: var(--gray-700);
    border-radius: var(--radius-lg);
    transition: all 0.2s ease;
  }

  .mobile-nav-link:hover,
  .mobile-nav-link.active {
    background: var(--brand-50);
    color: var(--brand-700);
  }

  .mobile-nav-cta {
    margin-top: var(--space-md);
    background: linear-gradient(135deg, var(--brand-600) 0%, var(--brand-700) 100%);
    color: white;
    justify-content: center;
  }

  .mobile-nav-cta:hover {
    background: linear-gradient(135deg, var(--brand-700) 0%, var(--brand-800) 100%);
    color: white;
  }

  .icon-close.hidden {
    display: none;
  }

  .menu-toggle.open .icon-menu {
    display: none;
  }

  .menu-toggle.open .icon-close {
    display: block;
  }

  @media (min-width: 768px) {
    .mobile-menu {
      display: none;
    }
  }
</style>

<script>
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const header = document.getElementById('site-header');

  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', () => {
      const isOpen = mobileMenu.classList.toggle('open');
      menuToggle.classList.toggle('open');
      menuToggle.setAttribute('aria-expanded', isOpen.toString());
      mobileMenu.setAttribute('aria-hidden', (!isOpen).toString());
      document.body.style.overflow = isOpen ? 'hidden' : '';
    });
  }

  // Header scroll effect
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY;

    if (currentScroll > 10) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }

    lastScroll = currentScroll;
  });
</script>
